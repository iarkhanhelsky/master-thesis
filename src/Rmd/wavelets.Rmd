# Вейвлет преобразование.

## Вейвлет. Определение. Основные понятия.
Любая локализованная $\mathbb{R}$-функция $\psi \in L_2(\mathbb{R})$, где $L_2([a,b])$ - множество интегрируемых в квадратах функций, называется $\mathbb{R}$-вейвлетом (или просто вейвлетом), если для нее существует функция $\overset{*}{\psi} \in L_2(\mathbb{R})$ такая, что семейства $\lbrace\psi_{jk}\rbrace$ и $\lbrace\overset{*}{\psi_{jk}}\rbrace$, построенные как

$$ \psi_{jk}(t) = 2^{j/2}\psi(2^jt-k), ~~ j,k \in \mathbb{Z} $$

и

$$ \psi^{jk}(t) = \overset{*}{\psi_{jk}}(t) = 2^{j/2}\overset{*}{\psi}(2^jt-k) $$

являются парными базисами функционального пространства $L_2(\mathbb{R})$[@daub].

Каждый таким образом определенный вейвлет $\psi$, независимо от того, ортогональный он или нет, позволяет любую функцию $f \in L_2(\mathbb{R})$ представить в виде ряда

$$
  f(t) = \sum_{j,k = -\infty}^{\infty} c_{jk}\psi_{jk}(t)
$$

коэффициенты которого определяются интегральным вейвлет-преобразованием $f$ относительно $\overset{*}{\psi}$.
Вейвлет-двойник $\overset{*}{\psi}$ -- единственный и сам является $\mathbb{R}$-вейвлетом. Пара $(\psi, \overset{*}{\psi})$ симметрична в том смысле, что $\psi$ в свою очередь является двойником для $\overset{*}{\psi}$.
Если $\mathbb{R}$-вейвлет $\psi$ обладает свойством ортоганальности, то $\overset{*}{\psi} \equiv \psi$, и $\lbrace \overset{*}{\psi_{jk}} \rbrace \equiv \lbrace \psi_{jk} \rbrace$ -- ортогональный базис.

Для многих практических целей достаточно, чтобы вейвлет обладал свойством полуортогональности, т.е. чтобы его базис Рисса [^riss] $\lbrace \psi_{jk} \rbrace$ удовлетворял условию $\langle \psi_{jk},  \psi_{lm}\rangle = 0$ при $j = l, ~ j,k,l,m \in \mathbb{Z}$.

[^riss]:
  _Система Рисса_ с постоянными $A$ и $B$ — такая система векторов $\{f_n\}_{n=1}^\infty \in H$ в гильбертовом пространстве *H*, что для любой последовательности комплексных чисел $c=\{c_n\}_{n=1}^\infty \in l_2$ ряд $\sum_{n=1}^\infty c_nf_n$ сходится по норме в *H*, причем
  $A\|c\|^2_{l_2}\leqslant \left\| \sum_{n=1}^\infty c_n f_n \right\|^2_H \leqslant B\|c\|^2_{l_2}$,
  _Базис Рисса_ — такая система Рисса, которая является базисом в *H*.
  Базис Рисса является обобщением понятия ортонормированного базиса, а двойное неравенство, данное в определении — обобщение неравенства Бесселя. Другое название базисов Рисса — _базисы, эквивалентные ортонормированным_.
  Система векторов является базисом Рисса тогда и только тогда, когда она может быть получена из ортонормированного базиса с помощью ограниченного обратимого преобразования.

$\mathbb{R}$-вейвлет называется неортогональным, если он не является полуортогональным вейвлетом. Однако, будучи $\mathbb{R}$-вейвлетом, он имеет двойника, и пара $(\psi, \overset{*}{\psi})$ дает возможность формировать семейства $\lbrace\psi_{jk}\rbrace$ и $\lbrace\overset{*}{\psi_{jk}}\rbrace$, удовлетворяющие условию биортогональности $\langle \psi_{jk}, \overset{*}{\psi_{lm}}\rangle = \delta_{jl}\delta_{km}, ~~ j,k,l,m \in \mathbb{Z}$ и позволяющие построить полноцыенные ряды по вейвлетам и реконструкционную формулу.
С необходимостью иметь обратное вейвлет преобразование (или реконструкционную формулу) связано большинство ограничений, накладываемых на вейвлет.

### Признаки вейвлета

Для практического применения важно знать признаки, которыми обязательно должна обладать функция, чтобы быть вейвлетом; приведем их здесь, а так же рассмотрим в качестве примеров некоторые хорошо известные функции и их соответствие этим необходимым признакам. Далее мы сформулируем несколько основных признаков вейвлет-функций.

* \textbf{Локализация.} Вейвлет-преобразование в отличие от преобразования Фурье использует локализованную базисную функцию. Вейвлет должен быть локализован и во временн$\acute{о}$м пространстве, и по частоте.

* \textbf{Нулевое среднее.}

\begin{equation}
\int_{-\infty}^{\infty} \psi(t)dt = 0
\end{equation}

Часто для приложений оказывается необходимым, чтобы не только нулевой, но и все первые $m$ моментов были равны нулю

\begin{equation}
\int_{-\infty}^{\infty} t^m\psi(t)dt = 0
\end{equation}

Такой вейвлет называется вейвлетом $m$-го порядка. Обладающие большим числом нулевых моментов вейвлеты позволяют, игнорируя наиболее регулярные полиномиальные составляющие сигнала, анализировать мелкомасштабные флуктуации и особенности высокого порядка.

* \textbf{Ограниченность.}

\begin{equation}
\int_{-\infty}^{\infty} |\psi(t)|^2dt = 0
\end{equation}

Оценка хорошей локализации и ограниченности может быть записана в виде $|\psi(t)| < (1+|t|^n)^{-1}$ или
$|\hat{\psi}(\omega)| < (1 + |k - \omega_0|^n)^{-1}$, здесь $\omega_0$ -- доминантная частота вейвлета, число $n$ должно быть возможно большим.

* \textbf{Автомодельность базиса.} Характерным признаком базиса вейвлет-преобразования является его самоподобие. Все вейвлеты данного семейства $\psi_{ab}(t)$ имеют то же число осцилляций, что и базисный вейвлет $\psi(t)$, поскольку получены из него посредством масштабных преборазований и сдвигов. Благодаря этому вейвлет-преобразование с успехом применяется для анализа фрактальных сигналов.

Функция Габора

$$ G(t) = \exp[i\Omega(t-t_0) - i\nu]\exp\Bigg[-\frac{(t-t_0)^2}{2\sigma^2}\Bigg] \frac{1}{\sigma(2\pi)^{1/2}} $$

представляет собой модулированную функцию Гаусса с четырьмя параметрами: сдвиг $t_0$, стандартное (среднеквадратичное) отклонение $\sigma$, частота модуляции $\Omega$ и фазовый сдвиг $\nu$. Разложение по функциям Габора является разложением по модулированным фрагментам синусоид. Длина фрагментов для всех частот постоянна, что дает различное число осцилляций для разных гармоник. Отсюда следует, что достаточно хорошо локализованная и в $t$-, и в $k$-пространстве функция габора не может быть базисной функцией вейвлет-преобразования, поскольку построенный на ее основе базис не обладает свойством самоподобия.
HAAR-вевлет (\ref{eq:haar}) -- пример ортогонального дискретного вейвлета, порождающего ортонормированный базис. Недостатками этого вейвлета являются негладкость -- резкие границы в $t$-пространстве, вследствие чего возникают бесконечные (убывающие как $k^{-1}$) "хвосты" в $k$-пространстве, а также несиметрия формы.

\begin{equation}\label{eq:haar}
\psi^H(t) = \begin{cases}
1, ~ 0 \leq t < 1/2 \\
-1,~ 1/2 \leq t < 1, \\
0, ~ t<0, ~ t\geq 1
\end{cases}
\end{equation}

 Для некоторых приложений эти недостатки несущественны, а иногда односторонность вейвлета даже становится достоинством. Часто применяется очень похожий, также дискрентый, но симметричный $FHAT$-вейвлет, более известный под названием ``Французская шляпа'' (French hat -- похож на цилиндр):
 
$$
\psi^H(t) =
\begin{cases}
        1, ~ |t| < 1/3 \\
        -1/2,~ 1/3 \leq |t| < 1, \\
        0, ~  |t| > 1
\end{cases}
$$
 
$$ \hat{\psi}(k) = 3I(k)\Big(\frac{\sin k}{k} - \frac{\sin 3k}{3k}\Big) $$

здесь $I(k)$ -- функция Хевисайда ($I(k) = 1$ при $k > 0$ и $I(k) = 0$ при $k \leq 0$).
FHAT-вейвлет, нерегулярный во временном пространстве и недостаточно быстро спадающий в пространстве частоти, и LP-вейвлет(Литтлвуда--Пели), наоборот, имеющий резко очерченные границы в $k$-пространстве и плохо спадающий в $t$-пространстве, можно считать предельными случаями, между которыми находятся практически все вейвлеты.

### Примеры вейвлетобразующих функций

Поскольку вейвлет-преобразование есть скалярное произведение анализирующего вейвлета на заданном масштабе и анализируемого сигнала, коэффициенты $W(a,b)$ содержат комбинированную информацию об анализирующем вейвлете и анализируемом сигнале (как и коэффициенты преобразования Фурье, которые содержат информацию о сигнале и о синусоидальной волне).
Выбор аналищирующего вейвлета, как правило определяется тем, какую информацию необходимо извлечь из сигнала. Каждый вейвлет имеет характерные особенности во временном и в частотном пространстве, поэтому иногда с помощью разных вейвлетов можно полнее выяснить и подчеркнуть те или иные совйства анализируемого сигнала.
Вещественные базисы часто конструируются на основе производных функции Гаусса:

$$ \psi_m(t) = (-1)^m \partial^m_t\Bigg[\exp(\frac{-t^2}{2})\Bigg], $$

$$ \hat{\psi}(k) = m(ik)^m\exp\Bigg(-\frac{k^2}{2}\Bigg) $$

(здесь $\partial^m_t = \partial^m[\dots]/\partial_t^m, m \geq 1)$. Более высокие производные имеют больше нулевых моментов и позволяют извлечь информацию об особенностях более высокого порядка, содержащихся в сигнале. При $m=1$ полученный вейвлет называют WAVE-вейвлетом, а при $m = 2$ -- MHAT-вейвлетом (Mexican hat).
MHAT-вейвлет, имеющий узкий энергетический спектр и два равных нулю момента (нулевой и первый), хорошо приспособлен для анализа сложных сигналов. Обобщенный на двумерный случай MHAT-вейвлет часто используется для анализа изотропных полей. Если же производная берется лишь в одном направлении, получается неизотропный базис с хорошей угловой избирательностью. Для построения такого базиса к масштабный преобразованиям и сдвигам базисного вейвлета необходимо добавить его вращение. При этом вейвлет приобретает еще и свойства поляризатора с углом поляризации, пропорциональным углу поворота вейвлета.
На основе функции Гаусса строится также хорошо известный DOG-вейвлет (Difference of Gaussians):

$$ \psi(t) = \exp\Big(-\frac{|t|^2}{2}\Big) - 0,5\exp\Big(-\frac{|t|^2}{8}\Big),$$

$$ \hat{psi}(t) = \frac{1}{(2\pi)^{1/2}}\Bigg[\exp\Big(-\frac{|k|^2}{2}\Big) - \exp(-2|k|^2)\Bigg]. $$
Наиболее часто используемый комлпексный базис строится на основе хорошо локализованного в $k$- и $r$-пространтсве вейвлета Морле(Morlet):

$$ \psi(r) = \exp(ik_0r)\exp\Big(-\frac{r^2}{2}\Big), $$

$$ \hat{\psi}(k) = I(k)\exp\Bigg[-\frac{(k-k_0)^2}{2}\Bigg]. $$

## Построение вейвлета Хаара
Пусть имеем некоторый сигнал $x(t)$, он может быть аппроксимирован взвешенной суммой \textit{импульсных} функций единичтной нормы:

$$  x(t) = \sum_i s_i \phi_{[t_j, t_j+1[}~, $$

где $\phi_{[t_j, t_{j+1}[}$ функция с окном $t_{j+1} - t_j$ :

$$
   \phi_{[t_j, t_{j+1}[} =
    \begin{cases}
        1, t \in [t_j, t_{j+1}[ \\
        0, t \not\in [t_j, t_{j+1}[
    \end{cases}
$$
    
Возьмем две таке импульсные функции

$$
    \phi_{[0, 1/2[} =
        \begin{cases}
            1, t \in [0, 1/2[ \\
            0, t \not\in [0, 1/2[
        \end{cases}
    \phi_{[1/2, 1[} =
        \begin{cases}
            1, t \in [1/2, 1[ \\
            0, t \not\in [1/2, 1[
        \end{cases}
$$
    
Сумма этих функций дает нам более широкую импульсную функцию

$$
    \phi_{[0, 1[} =  \phi_{[0, 1/2[} + \phi_{[1/2, 1[} =
        \begin{cases}
            1, t \in [0, 1[ \\
            0, t \not\in [0, 1[
        \end{cases}
$$
    
Разность дает нам базовый вейвлет Хаара[@haar]

$$
    \psi =  \phi_{[0, 1/2[} - \phi_{[1/2, 1[} =
        \begin{cases}
           ~~ 1, t \in [0, 1/2[ \\
            -1, t \in [1/2, 1[
        \end{cases}
$$

```{r, echo=FALSE, fig.cap='График базового вейвлета Хаара'}
  t <- seq(-0.1, 1.1, 0.001)
  qplot(t, psi(t), geom='line', xlab='t') + ylab(expression(psi))
```

Применяя подобные операции получаем бесконечное число функций вида

$$  \psi_{jk} = 2^{j/2}\psi(2^j (t - k))~, $$
которые вместе с $\phi_{]-\infty, \infty[}$ составляют базис в пространстве $L_2(\mathbb{R})$.

Таким образом $x(t)$ может быть представлен в виде:

$$
    x(t) = s_0\phi_{[0, 1/2[} + s_1 \phi_{[1/2, 1[]} = s_0\frac{\phi_{[0, 1[} + \psi_{[0, 1[}}{2} + s_1\frac{\phi_{[0, 1[} - \psi_{[0, 1[}}{2},
$$

где $(s_0 + s_1)/2$ представляет собой среднее функции(общую картину), а $(s_0 - s_1)/2$ представляет изменение функции (детали). Тем самым получено вейвлет-преобразование Хаара функции $x(t)$.

Пусть $\psi$ такое преобразование $t : \mathbb{R} \rightarrow [-1, 1]$, что

  $$
    \psi(t) =
      \begin{cases}
        -1, ~ t \in [0, \frac{1}{2}[ \\
        1, ~t \in[\frac{1}{2}, 1[ \\
        0, ~t \in \mathbb{R} \setminus [0, 1[
      \end{cases}
  $$

Пусть ткаже $\psi_{jk}$ преобразование $t: \mathbb{R} \rightarrow [-2^j, 2^j]$ такое, что

  $$
    \psi_{jk}(t) = 2^{j/2} \psi(2^j (t - k))
  $$

```{r, echo=FALSE, fig.cap='Примеры вейвлетов Хаара с различными параметрами смещения и масштабирования'}  
  t <- seq(-5, 5, 0.001)

  data <- rbind(
      data.frame(t = t, psi = psi(t)),
      data.frame(t = t, psi = psi(t, 2, 1)),
      data.frame(t = t, psi = psi(t, -2, -3)),
      data.frame(t=  t, psi = psi(t, 1, 2))
    )
  data$params <- rep(
    c(
      "j = 0, k = 0",
      "j = 2, k = 1",
      "j = -2, k = -3",
      "j = 1, k = 2"
      ),
    c(length(t), length(t), length(t), length(t)))

  ggplot(data,aes(t,psi, color=params)) + 
    scale_fill_discrete(name="Experimental\nCondition",
                         breaks=c("ctrl", "trt1", "trt2", "d"),
                         labels=c("Control", "Treatment 1", "Treatment 2", "d")) +
    geom_line() +
    ylab(expression(psi))    
```

## Построение вейвлета Добеши

Для построения различных вейвлетных разложений, связанных с равномерной сеткой, вводится кратно-масштабное уравнение. В простейшем случае (для вэйвлетов Хаара) оно принимает вид

\begin{equation}
\omega(x) \equiv \omega(2x) + \omega(2x-1).
\end{equation}

Для получения других вариантов вэйвлетных разложений задаются числами $d_j$ и рассматривают кратно-масштабное уравнение вида

\begin{equation}\label{eq:scaling_eq}
\omega(x) \equiv d_0\omega(2x) + d_1\omega(2x+1) + \dots + d_N\omega(2x - N) .
\end{equation}

Масштабирующую функцию $\omega(t)$ иногда подчинают тем или иным дополнительным условиям; примером таких условий являются условие нормирования и условия ортогональности:

\begin{equation}\label{eq:cond}
\begin{array}{lr}
  \int_{-\infty}^{\infty}|\omega(t)|^2dt = 1, & \int_{-\infty}^{\infty}\omega(2t-j)\omega(2t-k)dt = 0,~ j \neq k \\
\end{array}
\end{equation}

Следует заметить, что отыскание функции $\omega$ из условий (\ref{eq:scaling_eq})-(\ref{eq:cond}) является весьма непростым делом. Основной прием решения этой задачи -- применение преобразования Фурье к тождеству (\ref{eq:scaling_eq}); это приводит к представлению образа Фурье функции $\omega$ в виде бесконечного произведения, откуда можно, по-крайней мере, извлечь ее значения в двоичных точка вещественной оси (т.е. в точках, являющихся обыкновенными дробями со знаменателем $2^z,~ z \in \mathbb{Z}$).

В частности, если взять[@blatter]

\begin{equation*}
  \begin{array}{llll}
  d_0 = \frac{1 + \sqrt{3}}{4\sqrt{2}}, & d_1 = \frac{3 + \sqrt{3}}{4\sqrt{2}}, & d_2 = \frac{3 - \sqrt{3}}{4\sqrt{2}}, & d_3 = \frac{1 - \sqrt{3}}{4\sqrt{2}},
  \end{array}
\end{equation*}

а остальные коэффициенты $d_j$ положить равными нулю, то получается вейвлет, назывемые D4-вейвлетом Добеши. Эти коэффициенты задают масштабирующую функцию, если записать коэффициенты в обратом порядке, и поменять знак у каждого второго, получим коэффициенты для вейвлета.
