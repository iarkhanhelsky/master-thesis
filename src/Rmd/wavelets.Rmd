# Вейвлет преобразование. Вейвлет спектр временного ряда. 

## Вейвлет. Определение. Основные понятия.
Любая локализованная $\mathbb{R}$-функция $\psi \in L_2(\mathbb{R})$, где $L_2([a,b])$ - множество интегрируемых в квадратах функций, называется $\mathbb{R}$-вейвлетом (или просто вейвлетом), если для нее существует функция $\overset{*}{\psi} \in L_2(\mathbb{R})$ такая, что семейства $\lbrace\psi_{jk}\rbrace$ и $\lbrace\overset{*}{\psi_{jk}}\rbrace$, построенные как

$$
\psi_{jk}(t) = 2^{j/2}\psi(2^jt-k), ~~ j,k \in \mathbb{Z}
$$

и

$$
 \psi^{jk}(t) = \overset{*}{\psi_{jk}}(t) = 2^{j/2}\overset{*}{\psi}(2^jt-k)
$$

являются парными базисами функционального пространства $L_2(\mathbb{R})$[@daub].

Каждый таким образом определенный вейвлет $\psi$, независимо от того, ортогональный он или нет, позволяет любую функцию $f \in L_2(\mathbb{R})$ представить в виде ряда
$$
  f(t) = \sum_{j,k = -\infty}^{\infty} c_{jk}\psi_{jk}(t)
$$

коэффициенты которого определяются интегральным вейвлет-преобразованием $f$ относительно $\overset{*}{\psi}$.
Вейвлет-двойник $\overset{*}{\psi}$ -- единственный и сам является $\mathbb{R}$-вейвлетом. Пара $(\psi, \overset{*}{\psi})$ симметрична в том смысле, что $\psi$ в свою очередь является двойником для $\overset{*}{\psi}$.
Если $\mathbb{R}$-вейвлет $\psi$ обладает свойством ортоганальности, то $\overset{*}{\psi} \equiv \psi$, и $\lbrace \overset{*}{\psi_{jk}} \rbrace \equiv \lbrace \psi_{jk} \rbrace$ -- ортогональный базис.

Для многих практических целей достаточно, чтобы вейвлет обладал свойством полуортогональности, т.е. чтобы его базис Рисса [^riss] $\lbrace \psi_{jk} \rbrace$ удовлетворял условию $\langle \psi_{jk},  \psi_{lm}\rangle = 0$ при $j = l, ~ j,k,l,m \in \mathbb{Z}$.

[^riss]:
  _Система Рисса_ с постоянными $A$ и $B$ — такая система векторов $\{f_n\}_{n=1}^\infty \in H$ в гильбертовом пространстве *H*, что для любой последовательности комплексных чисел $c=\{c_n\}_{n=1}^\infty \in l_2$ ряд $\sum_{n=1}^\infty c_nf_n$ сходится по норме в *H*, причем
  $A\|c\|^2_{l_2}\leqslant \left\| \sum_{n=1}^\infty c_n f_n \right\|^2_H \leqslant B\|c\|^2_{l_2}$,
  _Базис Рисса_ — такая система Рисса, которая является базисом в *H*.
  Базис Рисса является обобщением понятия ортонормированного базиса, а двойное неравенство, данное в определении — обобщение неравенства Бесселя. Другое название базисов Рисса — _базисы, эквивалентные ортонормированным_.
  Система векторов является базисом Рисса тогда и только тогда, когда она может быть получена из ортонормированного базиса с помощью ограниченного обратимого преобразования.

$\mathbb{R}$-вейвлет называется неортогональным, если он не является полуортогональным вейвлетом. Однако, будучи $\mathbb{R}$-вейвлетом, он имеет двойника, и пара $(\psi, \overset{*}{\psi})$ дает возможность формировать семейства $\lbrace\psi_{jk}\rbrace$ и $\lbrace\overset{*}{\psi_{jk}}\rbrace$, удовлетворяющие условию биортогональности $\langle \psi_{jk}, \overset{*}{\psi_{lm}}\rangle = \delta_{jl}\delta_{km}, ~~ j,k,l,m \in \mathbb{Z}$ и позволяющие построить полноцыенные ряды по вейвлетам и реконструкционную формулу.
С необходимостью иметь обратное вейвлет преобразование (или реконструкционную формулу) связано большинство ограничений, накладываемых на вейвлет.

## Построение вейвлета Хаара
Пусть имеем некоторый сигнал $x(t)$, он может быть аппроксимирован взвешенной суммой \textit{импульсных} функций единичтной нормы:
    $$
        x(t) = \sum_i s_i \phi_{[t_j, t_j+1[}~,
    $$
где $\phi_{[t_j, t_{j+1}[}$ функция с окном $t_{j+1} - t_j$ :
    $$
       \phi_{[t_j, t_{j+1}[} =
        \begin{cases}
            1, t \in [t_j, t_{j+1}[ \\
            0, t \not\in [t_j, t_{j+1}[
        \end{cases}
    $$
Возьмем две таке импульсные функции
    $$
        \phi_{[0, 1/2[} =
            \begin{cases}
                1, t \in [0, 1/2[ \\
                0, t \not\in [0, 1/2[
            \end{cases}
        \phi_{[1/2, 1[} =
            \begin{cases}
                1, t \in [1/2, 1[ \\
                0, t \not\in [1/2, 1[
            \end{cases}
    $$
Сумма этих функций дает нам более широкую импульсную функцию
    $$
        \phi_{[0, 1[} =  \phi_{[0, 1/2[} + \phi_{[1/2, 1[} =
            \begin{cases}
                1, t \in [0, 1[ \\
                0, t \not\in [0, 1[
            \end{cases}
    $$
Разность дает нам базовый вейвлет Хаара[@haar]
$$
    \psi =  \phi_{[0, 1/2[} - \phi_{[1/2, 1[} =
        \begin{cases}
           ~~ 1, t \in [0, 1/2[ \\
            -1, t \in [1/2, 1[
        \end{cases}
$$

```{r, echo=FALSE, fig.cap='График базового вейвлета Хаара'}
  t <- seq(-0.1, 1.1, 0.001)
  qplot(t, psi(t), geom='line', xlab='t') + ylab(expression(psi))
```

Применяя подобные операции получаем бесконечное число функций вида
    $$
        \psi_{jk} = 2^{j/2}\psi(2^j (t - k))~,
    $$
которые вместе с $\phi_{]-\infty, \infty[}$ составляют базис в пространстве $L_2(\mathbb{R})$.

Таким образом $x(t)$ может быть представлен в виде:
$$
    x(t) = s_0\phi_{[0, 1/2[} + s_1 \phi_{[1/2, 1[]} = s_0\frac{\phi_{[0, 1[} + \psi_{[0, 1[}}{2} + s_1\frac{\phi_{[0, 1[} - \psi_{[0, 1[}}{2},
$$
где $(s_0 + s_1)/2$ представляет собой среднее функции(общую картину), а $(s_0 - s_1)/2$ представляет изменение функции (детали). Тем самым получено вейвлет-преобразование Хаара функции $x(t)$.

Пусть $\psi$ такое преобразование $t : \mathbb{R} \rightarrow [-1, 1]$, что
  $$
    \psi(t) =
      \begin{cases}
        -1, ~ t \in [0, \frac{1}{2}[ \\
        1, ~t \in[\frac{1}{2}, 1[ \\
        0, ~t \in \mathbb{R} \setminus [0, 1[
      \end{cases}
  $$

Пусть ткаже $\psi_{jk}$ преобразование $t: \mathbb{R} \rightarrow [-2^j, 2^j]$ такое, что
  $$
    \psi_{jk}(t) = 2^{j/2} \psi(2^j (t - k))
  $$


```{r, echo=FALSE, fig.cap='Примеры вейвлетов Хаара с различными параметрами смещения и масштабирования'}  
  t <- seq(-5, 5, 0.001)

  data <- rbind(
      data.frame(t = t, psi = psi(t)),
      data.frame(t = t, psi = psi(t, 2, 1)),
      data.frame(t = t, psi = psi(t, -2, -3)),
      data.frame(t=  t, psi = psi(t, 1, 2))
    )
  data$params <- rep(
    c(
      "j = 0, k = 0",
      "j = 2, k = 1",
      "j = -2, k = -3",
      "j = 1, k = 2"
      ),
    c(length(t), length(t), length(t), length(t)))

  ggplot(data,aes(t,psi, color=params)) + 
    scale_fill_discrete(name="Experimental\nCondition",
                         breaks=c("ctrl", "trt1", "trt2", "d"),
                         labels=c("Control", "Treatment 1", "Treatment 2", "d")) +
    geom_line() +
    ylab(expression(psi))    
```

## Вейвлет спектр.

В этой части мы введем понятие вейвлет спектра временного ряда, аналогично тому, как вводится понятие спектральной плотности ряда (в смысле преобразования Фурье). 

